<!doctype html>
<html>
<head>
 <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Calendar Schedule</title>
    <link href="https://www.cssscript.com/demo/sticky.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/color-calendar@1.0.5/dist/css/theme-glass.css" />
</head>

<body>
  <div class="container">
    <div class="title"> 
        <h1>Driving Simulator Booking</h1>
    </div>
    <div class="row">
        <div>
            <div id="color-calendar"></div>
            <div class="legend-container">
                <div class="legend-header">Calendar legend</div>
                <div class="color-row">
                    <div>
                        <div class="avail-icon"></div>
                        Available
                    </div>
                    <div>
                        <div class="unavail-icon"></div>
                        Not available
                    </div>
                    <div>
                        <div class="selected-icon"></div>
                        Selected
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <h2 class="header">Available Time Slots</h2>
            <div class="sub-header" id="selected-date"></div>
            <div class="events-display"></div>
        </div>
    </div>
    <div class="row">
        <div class="selected-slots">
            <h2>Selected Time Slots</h2>
            <div class="selectedSlott"></div>
        </div>
    </div>
    <div class="button-container">
        <button class="submit-button">Submit</button>
    </div>

    <div id="demo"></div>
    <div id="demoo"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/color-calendar@1.0.5/dist/bundle.min.js"></script>
<!-- <script src="calendar/script.js"></script> -->
<script>
    new Calendar({
        id: '#color-calendar',
        calendarSize: 'large',
        theme: 'glass',
        primaryColor: '#4F98DB',
        headerBackgroundColor: '#4F98DB',
        eventsData:[
        // correct slots:
        {
            start: '2022-09-12T06:00:00',
            end: '2022-09-12T20:30:00',
            slot: '10:30 AM - 11:30 AM',
            session: 'Session 3',
        },
        {
            start: '2022-09-12T06:00:00',
            end: '2022-09-12T20:30:00',
            slot: '12:30 PM - 1:30 PM',
            session: 'Session 5',
        },
        {
            start: '2022-09-12T06:00:00',
            end: '2022-09-12T20:30:00',
            slot: '4:30 PM - 5:30 PM',
            session: 'Session 9',
        },
        {
            start: '2022-09-19T06:00:00',
            end: '2022-09-19T20:30:00',
            slot: '10:30 AM - 11:30 AM',
            session: 'Session 3',
        },
        {
            start: '2022-09-19T06:00:00',
            end: '2022-09-19T20:30:00',
            slot: '12:30 PM - 1:30 PM',
            session: 'Session 5',
        },
        {
            start: '2022-09-19T06:00:00',
            end: '2022-09-19T20:30:00',
            slot: '4:30 PM - 5:30 PM',
            session: 'Session 9',
        },
        {
            start: '2022-09-26T06:00:00',
            end: '2022-09-26T20:30:00',
            slot: '10:30 AM - 11:30 AM',
            session: 'Session 3',
        },
        {
            start: '2022-09-26T06:00:00',
            end: '2022-09-26T20:30:00',
            slot: '12:30 PM - 1:30 PM',
            session: 'Session 5',
        },
        {
            start: '2022-09-26T06:00:00',
            end: '2022-09-26T20:30:00',
            slot: '4:30 PM - 5:30 PM',
            session: 'Session 9',
        },
        // incorrect slots:
        {
            start: '2022-04-12T06:00:00',
            end: '2022-04-12T20:30:00',
            slot: '8:30 AM - 9:30 AM',
            session: 'Session 1',
        },
        {
            start: '2022-04-12T06:00:00',
            end: '2022-04-12T20:30:00',
            slot: '12:30 PM - 1:30 PM',
            session: 'Session 5',
        },
        {
            start: '2022-04-13T06:00:00',
            end: '2022-04-13T20:30:00',
            slot: '3:30 PM - 4:30 PM',
            session: 'Session 8',
        },
        {
            start: '2022-04-13T06:00:00',
            end: '2022-04-13T20:30:00',
            slot: '4:30 PM - 5:30 PM',
            session: 'Session 9',
        },
        {
            start: '2022-04-13T06:00:00',
            end: '2022-04-13T20:30:00',
            slot: '5:30 PM - 6:30 PM',
            session: 'Session 10',
        },
        {
            start: '2022-04-13T06:00:00',
            end: '2022-04-13T20:30:00',
            slot: '6:30 PM - 7:30 PM',
            session: 'Session 11',
        },
        {
            start: '2022-04-15T06:00:00',
            end: '2022-04-15T20:30:00',
            slot: '8:30 AM - 9:30 AM',
            session: 'Session 1',
        },
        {
            start: '2022-04-16T06:00:00',
            end: '2022-04-16T20:30:00',
            slot: '8:30 AM - 9:30 AM',
            session: 'Session 1',
        },
        {
            start: '2022-04-16T06:00:00',
            end: '2022-04-16T20:30:00',
            slot: '9:30 AM - 10:30 AM',
            session: 'Session 2',
        },
        {
            start: '2022-04-16T06:00:00',
            end: '2022-04-16T20:30:00',
            slot: '11:30 AM - 12:30 PM',
            session: 'Session 4',
        },
        {
            start: '2022-04-16T06:00:00',
            end: '2022-04-16T20:30:00',
            slot: '12:30 PM - 1:30 PM',
            session: 'Session 5',
        },
        {
            start: '2022-04-16T06:00:00',
            end: '2022-04-16T20:30:00',
            slot: '1:30 PM - 2:30 PM',
            session: 'Session 6',
        },
        {
            start: '2022-04-16T06:00:00',
            end: '2022-04-16T20:30:00',
            slot: '2:30 PM - 3:30 PM',
            session: 'Session 7',
        },
        {
            start: '2022-04-16T06:00:00',
            end: '2022-04-16T20:30:00',
            slot: '7:30 PM - 8:30 PM',
            session: 'Session 12',
        },
        ],
        dateChanged: (currentDate, events) => {
                const events_display = document.querySelector('.events-display');
                let events_html = '';
                console.log(currentDate, events);
                document.getElementById('selected-date').innerHTML = currentDate.toDateString();
                events.forEach(event => {
                events_html += `
                    <div id="available-timeslot" onclick="displaySelectedSlot(this)" class="avail-timeslot">
                        <p class="event-slot">${event.slot}</p>
                        <p>${event.session}<p>
                    </div>
                `
                });
                if(events_html) {
                    events_display.innerHTML = events_html;
                    // this prints element in console but not sure where to pass data
                    events_display.onclick = function(e){console.log(e)};
                } else {
                    events_display.innerHTML = '<div class="no-events-text">There are no more available slots. <br> Please select an available date that is marked in green.</div>';
                }
            },
        })

        if (document.querySelector(".selectedSlott").innerHTML.length == 0) {
            document.querySelector(".selectedSlott").innerHTML = `<p>Please select a timeslot above.</p>`
        }

        let selectedDatesArr = [];
        let selected_slots_html = '';
        var dict = {};

        function hasKeySetTo(obj, key, value) {
            return obj.hasOwnProperty(key) && obj[key].includes(value);
        }

        function displaySelectedSlot(element) {

            console.log(element);

            const currDate = document.getElementById('selected-date').innerHTML;

            // get selected session no.
            const sessionNo = element.innerHTML.split("Session")[1].trim().charAt(0);

            // add selected timeslot html only if timeslot not found in dict
            if (!hasKeySetTo(dict, currDate, sessionNo)) {
                selected_slots_html += `<div class="selected-timeslot">`;
                selected_slots_html += `<b>` + currDate + `</b>`;
                selected_slots_html += element.innerHTML;
                selected_slots_html += '</div>'
                document.querySelector(".selectedSlott").innerHTML = selected_slots_html;
            }

            // true if "key" in dict
            if (currDate in dict) {
                // if value does not exists
                if (!dict[currDate].includes(sessionNo)) {
                    //add value to dict
                    dict[currDate].push(sessionNo);
                }
            } else {
                // add key-value to dict with value initialized as array
                dict[currDate] = [sessionNo];
            }

            // display dict items
            document.getElementById('demoo').innerHTML = JSON.stringify(dict);
        }

</script>
</body>
</html>